<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Plataforma de streaming de canales en vivo - Deportes, PelÃ­culas, Series, Documentales y mÃ¡s">
    <meta name="author" content="Kl4rkx">
    <meta name="theme-color" content="#0057FF">
    
    <!-- Favicons -->
    <link rel="icon" type="image/svg+xml" href="assets/icons/favicon.svg">
    <link rel="mask-icon" href="assets/icons/favicon.svg" color="#0057FF">
    
    <!-- Apple Mobile Web App -->
    <link rel="apple-touch-icon" href="assets/icons/favicon.svg">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="./public/manifest.json">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="M3U8 Streaming Platform">
    <meta property="og:description" content="Plataforma de streaming de canales en vivo">
    <meta property="og:image" content="./assets/icons/favicon.svg">
    
    <title>Streaming de Canales en Vivo | Free IPTV Player</title>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com/3.4.14"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#0057FF'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif']
                    }
                }
            }
        }
    </script>
    
    <!-- Google Fonts - Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Custom Stylesheets -->
    <link rel="stylesheet" href="./src/css/styles.css">
    <link rel="stylesheet" href="./src/css/modal.css">
    
    <!-- iOS Safari Safe Area Support -->
    <style>
        :root {
            --safe-area-inset-top: env(safe-area-inset-top, 0px);
            --safe-area-inset-right: env(safe-area-inset-right, 0px);
            --safe-area-inset-bottom: env(safe-area-inset-bottom, 0px);
            --safe-area-inset-left: env(safe-area-inset-left, 0px);
        }
        
        /* Fix for Safari iOS white bars - use dvh (dynamic viewport height) */
        html {
            height: 100%;
            background: #000;
        }
        
        body {
            min-height: 100dvh;
            min-height: -webkit-fill-available;
            position: relative;
            padding-top: var(--safe-area-inset-top);
            padding-bottom: var(--safe-area-inset-bottom);
        }
    </style>
</head>
<body class="font-sans antialiased bg-gradient-to-br from-gray-950 via-gray-900 to-black text-white">
    <!-- Loading Screen -->
    <div id="loadingPage" class="fixed inset-0 bg-gradient-to-br from-gray-950 via-gray-900 to-black flex flex-col justify-center items-center z-[10000] transition-all duration-500">
        <div class="loading-spinner w-12 h-12 border-4 border-gray-700 border-t-primary rounded-full"></div>
        <div class="loading-text text-white text-2xl mt-6 font-medium">Cargando canales...</div>
    </div>

    <!-- Main Container -->
    <div class="container mx-auto px-4 sm:px-6 lg:px-8 max-w-7xl py-8 lg:py-12">
        <!-- Header -->
        <header class="mb-12 lg:mb-16">
            <!-- Top Bar with Language Switcher and Parental Control -->
            <div class="relative flex justify-between items-start mb-8 min-h-[48px]">
                <!-- Language Switcher (left) -->
                <a href="./index-en.html" 
                   class="inline-flex items-center gap-2 text-white no-underline px-4 py-2 bg-white/10 backdrop-blur-sm rounded-lg text-sm font-semibold hover:bg-white/20 transition-all duration-300 hover:scale-105 z-20">
                    ğŸ‡¬ğŸ‡§ English
                </a>
                
                <!-- Parental Control Button (right) -->
                <button id="parentalBtn" 
                        onclick="toggleControlParental()" 
                        title="Control Parental" 
                        aria-label="Control Parental"
                        class="inline-flex items-center justify-center bg-white/10 backdrop-blur-sm border border-white/20 text-white px-4 py-2 rounded-lg cursor-pointer text-xl transition-all duration-300 hover:bg-white/20 hover:scale-105 min-w-[44px] min-h-[44px] z-20">
                    ğŸ”’
                </button>
            </div>
            
            <!-- Main Title (centered, below buttons) -->
            <div class="text-center">
                <!-- Professional title without emoji, with modern gradient and shadow effects -->
                <h1 class="text-4xl sm:text-5xl lg:text-7xl font-extrabold mb-4 leading-tight px-4 tracking-tight">
                    <span class="bg-gradient-to-r from-blue-400 via-primary to-blue-600 bg-clip-text text-transparent inline-block">
                        Free IPTV Player
                    </span>
                </h1>
                <p class="text-lg sm:text-xl text-gray-300 font-medium mb-6 max-w-2xl mx-auto">
                    Streaming de canales en vivo
                </p>
            </div>
            
            <!-- Search Box -->
            <div class="search-box mt-8 flex justify-center">
                <input type="text" 
                       id="searchInput" 
                       placeholder="ğŸ” Buscar canal..." 
                       autocomplete="off" 
                       autocorrect="off" 
                       autocapitalize="off" 
                       spellcheck="false"
                       aria-label="Buscar canales"
                       class="w-full max-w-2xl px-6 py-4 text-base border-none rounded-full outline-none shadow-lg bg-white text-gray-900 placeholder-gray-500 focus:ring-4 focus:ring-primary/30 transition-all duration-300">
            </div>
        </header>

        <!-- Controls Bar -->
        <div class="controls-bar flex justify-center gap-4 mb-8 flex-wrap">
            <button class="control-btn px-6 py-3 bg-white/10 backdrop-blur-sm border border-white/20 text-white rounded-xl cursor-pointer text-sm font-medium transition-all duration-300 hover:bg-white/20 hover:-translate-y-1 hover:shadow-lg" 
                    onclick="expandAllCategories()" 
                    aria-label="Expandir todas las categorÃ­as">
                ğŸ“‚ Expandir
            </button>
            <button class="control-btn px-6 py-3 bg-white/10 backdrop-blur-sm border border-white/20 text-white rounded-xl cursor-pointer text-sm font-medium transition-all duration-300 hover:bg-white/20 hover:-translate-y-1 hover:shadow-lg" 
                    onclick="collapseAllCategories()" 
                    aria-label="Colapsar todas las categorÃ­as">
                ğŸ“ Colapsar
            </button>
            <button class="control-btn px-6 py-3 bg-primary hover:bg-blue-600 text-white rounded-xl cursor-pointer text-sm font-medium transition-all duration-300 hover:-translate-y-1 hover:shadow-lg hover:shadow-primary/50" 
                    onclick="openPlaylistModal()" 
                    aria-label="Cargar lista M3U">
                ğŸ“¥ Cargar Lista M3U
            </button>
            <span class="control-btn px-6 py-3 bg-white/10 backdrop-blur-sm border border-white/20 text-white rounded-xl text-sm font-medium cursor-default" 
                  aria-label="Total de canales">
                ğŸ“Š <span id="totalChannels">0</span> canales
            </span>
        </div>

        <!-- Channels Container -->
        <div id="channelsContainer" class="space-y-6"></div>
        
        <!-- No Results Message -->
        <div class="no-results text-center py-16 text-2xl font-medium hidden" id="noResults">
            No se encontraron canales
        </div>
        
        <!-- Footer -->
        <footer class="text-center py-12 mt-16 border-t border-white/10 opacity-70">
            <p class="text-base mb-2">
                Hecho con â¤ï¸ por 
                <a href="https://github.com/Kl4rkx" 
                   target="_blank" 
                   rel="noopener noreferrer" 
                   class="text-primary no-underline font-semibold hover:text-blue-400 transition-colors duration-300">
                    Kl4rkx
                </a>
            </p>
            <p class="text-sm opacity-80 mt-2">
                <a href="https://github.com/Kl4rkx/free-iptv-player" 
                   target="_blank" 
                   rel="noopener noreferrer" 
                   class="text-primary no-underline hover:text-blue-400 transition-colors duration-300">
                    Free IPTV Player
                </a> - 100% Legal & Open Source
            </p>
        </footer>
    </div>

    <!-- Video Player Modal -->
    <div class="video-modal hidden fixed inset-0 bg-black/95 z-[1000] items-center justify-center p-4" 
         id="videoModal" 
         role="dialog" 
         aria-modal="true" 
         aria-label="Reproductor de video">
        <div class="video-container w-full max-w-6xl mx-auto relative">
            <button class="close-button absolute -top-12 right-0 bg-red-500 hover:bg-red-600 text-white border-none px-6 py-3 rounded-lg cursor-pointer text-base font-bold transition-all duration-300 hover:scale-105 min-w-[44px] min-h-[44px]" 
                    onclick="closeVideo()" 
                    aria-label="Cerrar reproductor">
                âœ• Cerrar
            </button>
            <div class="loading-indicator absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 text-white text-xl hidden" 
                 id="loadingIndicator">
                â³ Cargando stream...
            </div>
            <video id="videoPlayer" 
                   controls 
                   autoplay 
                   playsinline 
                   webkit-playsinline 
                   x5-playsinline
                   aria-label="Video player"
                   class="w-full max-h-[80vh] rounded-xl bg-black shadow-2xl"></video>
        </div>
    </div>

    <!-- Playlist Loader Modal -->
    <div class="playlist-modal hidden fixed inset-0 bg-black/80 backdrop-blur-sm z-[2000] items-center justify-center p-4" 
         id="playlistModal" 
         role="dialog" 
         aria-modal="true" 
         aria-label="Cargar lista de canales">
        <div class="playlist-content bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 rounded-2xl p-8 w-full max-w-2xl max-h-[90vh] overflow-y-auto shadow-2xl border border-white/10">
            <div class="playlist-header flex justify-between items-center mb-6">
                <h2 class="text-3xl font-bold">ğŸ“¥ Cargar Lista de Canales</h2>
                <button class="playlist-close bg-white/10 hover:bg-white/20 border-none text-white text-2xl cursor-pointer w-10 h-10 rounded-full flex items-center justify-center transition-all duration-300 hover:rotate-90" 
                        onclick="closePlaylistModal()" 
                        aria-label="Cerrar modal">
                    âœ•
                </button>
            </div>

            <!-- Tabs -->
            <div class="tabs-container flex gap-3 mb-6 border-b-2 border-white/20 pb-2" role="tablist">
                <button class="tab-btn active flex-1 bg-white/10 hover:bg-white/20 border-none text-white px-5 py-3 cursor-pointer rounded-t-xl text-sm transition-all duration-300 font-medium" 
                        onclick="switchTab(event, 'url')" 
                        role="tab" 
                        aria-selected="true">
                    ğŸŒ Desde URL
                </button>
                <button class="tab-btn flex-1 bg-white/10 hover:bg-white/20 border-none text-white px-5 py-3 cursor-pointer rounded-t-xl text-sm transition-all duration-300 font-medium" 
                        onclick="switchTab(event, 'file')" 
                        role="tab" 
                        aria-selected="false">
                    ğŸ“ Archivo Local
                </button>
                <button class="tab-btn flex-1 bg-white/10 hover:bg-white/20 border-none text-white px-5 py-3 cursor-pointer rounded-t-xl text-sm transition-all duration-300 font-medium" 
                        onclick="switchTab(event, 'repo')" 
                        role="tab" 
                        aria-selected="false">
                    ğŸ“‚ Repositorio
                </button>
            </div>

            <!-- Tab: From URL -->
            <div class="tab-content active py-4" id="tab-url" role="tabpanel">
                <div class="input-group mb-5">
                    <label for="urlInput" class="block mb-2 font-semibold text-sm">URL de la lista M3U/M3U8:</label>
                    <input type="url" 
                           id="urlInput" 
                           value="https://iptv-org.github.io/iptv/index.m3u" 
                           placeholder="https://ejemplo.com/lista.m3u8" 
                           aria-label="URL de la lista"
                           class="w-full px-4 py-3 border-2 border-white/20 rounded-lg bg-white/10 text-white text-base placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-primary/50 transition-all duration-300">
                </div>
                <div class="input-group mb-5">
                    <label for="urlCategory" class="block mb-2 font-semibold text-sm">CategorÃ­a por defecto (opcional):</label>
                    <input type="text" 
                           id="urlCategory" 
                           placeholder="Ej: deportes, peliculas..." 
                           aria-label="CategorÃ­a por defecto"
                           class="w-full px-4 py-3 border-2 border-white/20 rounded-lg bg-white/10 text-white text-base placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-primary/50 transition-all duration-300">
                </div>
                <button class="load-btn w-full px-6 py-4 bg-green-500 hover:bg-green-600 border-none text-white rounded-lg cursor-pointer text-base font-bold transition-all duration-300 hover:scale-105 hover:shadow-lg hover:shadow-green-500/50 mt-3" 
                        onclick="loadFromURL()" 
                        aria-label="Cargar desde URL">
                    â¬‡ï¸ Cargar desde URL
                </button>
                <div class="status-message rounded-lg p-3 mt-3 text-center hidden" id="urlStatus" role="status"></div>
            </div>

            <!-- Tab: From File -->
            <div class="tab-content hidden py-4" id="tab-file" role="tabpanel">
                <div class="input-group mb-5">
                    <label for="fileInput" class="block mb-2 font-semibold text-sm">Selecciona un archivo M3U/M3U8:</label>
                    <div class="file-input-wrapper relative inline-block w-full">
                        <label class="file-input-label block px-4 py-3 bg-white/10 hover:bg-white/20 border-2 border-dashed border-white/50 rounded-lg text-center cursor-pointer transition-all duration-300">
                            <input type="file" 
                                   id="fileInput" 
                                   accept=".m3u,.m3u8" 
                                   onchange="updateFileName()" 
                                   aria-label="Seleccionar archivo"
                                   class="hidden">
                            <span id="fileName" class="font-medium">ğŸ“„ Click para seleccionar archivo</span>
                        </label>
                    </div>
                </div>
                <div class="input-group mb-5">
                    <label for="fileCategory" class="block mb-2 font-semibold text-sm">CategorÃ­a por defecto (opcional):</label>
                    <input type="text" 
                           id="fileCategory" 
                           placeholder="Ej: deportes, peliculas..." 
                           aria-label="CategorÃ­a por defecto"
                           class="w-full px-4 py-3 border-2 border-white/20 rounded-lg bg-white/10 text-white text-base placeholder-white/50 focus:outline-none focus:ring-2 focus:ring-primary/50 transition-all duration-300">
                </div>
                <button class="load-btn w-full px-6 py-4 bg-green-500 hover:bg-green-600 border-none text-white rounded-lg cursor-pointer text-base font-bold transition-all duration-300 hover:scale-105 hover:shadow-lg hover:shadow-green-500/50 mt-3" 
                        onclick="loadFromFile()" 
                        aria-label="Cargar desde archivo">
                    â¬‡ï¸ Cargar desde archivo
                </button>
                <div class="status-message rounded-lg p-3 mt-3 text-center hidden" id="fileStatus" role="status"></div>
            </div>

            <!-- Tab: From Repository -->
            <div class="tab-content hidden py-4" id="tab-repo" role="tabpanel">
                <div class="input-group mb-5">
                    <label class="block mb-2 font-semibold text-sm">Listas disponibles en el repositorio:</label>
                    <div class="repo-list max-h-80 overflow-y-auto bg-black/20 rounded-lg p-3 space-y-2" role="listbox">
                    <div class="repo-item px-4 py-3 bg-white/10 hover:bg-white/20 rounded-lg cursor-pointer transition-all duration-300 hover:translate-x-1 flex justify-between items-center" 
                        onclick="selectRepoFile(event, 'data/canales-tv.m3u8')" 
                             role="option">
                            <span class="font-medium">ğŸ“º canales-tv.m3u8</span>
                            <span class="text-xs opacity-70">TV en vivo</span>
                        </div>
                    <div class="repo-item px-4 py-3 bg-white/10 hover:bg-white/20 rounded-lg cursor-pointer transition-all duration-300 hover:translate-x-1 flex justify-between items-center" 
                        onclick="selectRepoFile(event, 'data/listam3u8.m3u8')" 
                             role="option">
                            <span class="font-medium">ğŸ“¡ listam3u8.m3u8</span>
                            <span class="text-xs opacity-70">Lista principal</span>
                        </div>
                    <div class="repo-item px-4 py-3 bg-white/10 hover:bg-white/20 rounded-lg cursor-pointer transition-all duration-300 hover:translate-x-1 flex justify-between items-center" 
                        onclick="selectRepoFile(event, 'data/canales.m3u')" 
                             role="option">
                            <span class="font-medium">ğŸ“‹ canales.m3u</span>
                            <span class="text-xs opacity-70">Canales generales</span>
                        </div>
                    <div class="repo-item px-4 py-3 bg-white/10 hover:bg-white/20 rounded-lg cursor-pointer transition-all duration-300 hover:translate-x-1 flex justify-between items-center" 
                        onclick="selectRepoFile(event, 'data/mascanales.m3u')" 
                             role="option">
                            <span class="font-medium">â• mascanales.m3u</span>
                            <span class="text-xs opacity-70">Canales adicionales</span>
                        </div>
                    </div>
                </div>
                <input type="hidden" id="selectedRepoFile">
                <button class="load-btn w-full px-6 py-4 bg-green-500 hover:bg-green-600 disabled:bg-white/20 disabled:cursor-not-allowed border-none text-white rounded-lg cursor-pointer text-base font-bold transition-all duration-300 hover:scale-105 hover:shadow-lg hover:shadow-green-500/50 disabled:hover:scale-100 disabled:hover:shadow-none mt-3" 
                        onclick="loadFromRepo()" 
                        id="repoLoadBtn" 
                        disabled 
                        aria-label="Cargar lista seleccionada">
                    â¬‡ï¸ Cargar lista seleccionada
                </button>
                <div class="status-message rounded-lg p-3 mt-3 text-center hidden" id="repoStatus" role="status"></div>
            </div>
        </div>
    </div>

    <!-- External Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@1.4.14"></script>
    
    <!-- Demo Channels - 100% Legal & Ethical Content -->
    <script src="./data/canales-demo.js"></script>
    
    <!-- App Scripts (ES6 Modules) -->
    <script type="module" src="./src/js/app.js"></script>
</body>
</html>
